<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>AI 헬스코치 v0.7 GPT-5</title>
  <link rel="stylesheet" href="styles.css"/>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.16.0/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/pose-detection@3.6.1/dist/pose-detection.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose@0.5/pose.js"></script>
</head>
<body>
<header>
  <h1>AI 헬스코치 <span class="badge">v0.7 GPT-5</span></h1>
  <p>맞춤 루틴 → 즉시 운동 시작(카메라+음성)까지 한 번에</p>
</header>

<main>
  <section class="card">
    <div class="row">
      <div class="step active" id="s1">① 프로필</div>
      <div class="step" id="s2">② 환경·목표</div>
      <div class="step" id="s3">③ 루틴 & 시작</div>
    </div>
  </section>

  <!-- Step1 -->
  <section class="card" id="step1">
    <h2>기본 정보</h2>
    <div class="grid">
      <label>성별<select id="sex"><option>남</option><option>여</option><option>기타</option></select></label>
      <label>나이(세)<input id="age" type="number" min="10" max="90"></label>
      <label>키(cm)<input id="height" type="number" min="120" max="230" required></label>
      <label>몸무게(kg)<input id="weight" type="number" min="30" max="200" required></label>
      <label>체지방(%)<input id="bodyfat" type="number" min="1" max="60" step="0.1"></label>
    </div>
    <div class="row"><button id="toStep2">다음</button></div>
  </section>

  <!-- Step2 -->
  <section class="card hidden" id="step2">
    <h2>환경 · 목표</h2>
    <div class="grid">
      <label>운동 수준
        <select id="level"><option value="beginner">초보</option><option value="intermediate">중급</option><option value="advanced">상급</option></select>
      </label>
      <label>운동 경력(년)<input id="experienceYears" type="number" min="0" max="20"></label>
      <label>환경<select id="environment"><option>헬스장</option><option>홈트</option></select></label>
      <label>주당 가능일수<select id="daysPerWeek"><option>2</option><option>3</option><option>4</option><option>5</option><option>6</option><option>7</option></select></label>
      <label>수면(시간)<input id="sleepHours" type="number" min="3" max="12" step="0.5"></label>
      <label>식단관리<select id="diet"><option>한다</option><option>안한다</option></select></label>
      <label>목표<select id="goal"><option>감량</option><option>증량</option><option>유지</option><option>재활</option></select></label>
      <label>목표 체중(kg)<input id="targetWeight" type="number" min="30" max="200"></label>
      <label>기간(주)<input id="periodWeeks" type="number" min="4" max="52" value="12"></label>
    </div>
    <div class="row">
      <fieldset>
        <legend>보유 장비</legend>
        <label><input type="checkbox" class="eq" value="덤벨"> 덤벨</label>
        <label><input type="checkbox" class="eq" value="바벨"> 바벨</label>
        <label><input type="checkbox" class="eq" value="밴드"> 밴드</label>
        <label><input type="checkbox" class="eq" value="없음"> 없음</label>
      </fieldset>
      <fieldset>
        <legend>부상/주의</legend>
        <label><input type="checkbox" class="iss" value="허리"> 허리</label>
        <label><input type="checkbox" class="iss" value="어깨"> 어깨</label>
        <label><input type="checkbox" class="iss" value="무릎"> 무릎</label>
      </fieldset>
    </div>
    <div class="row">
      <button class="ghost" id="back1">이전</button>
      <button id="requestRoutine">AI 루틴 추천받기 & 코칭 시작</button>
    </div>
  </section>

  <!-- Step3 -->
  <section class="card hidden" id="step3">
    <h2>AI 추천 루틴</h2>
    <div class="row">
      <button id="toggleRoutineView" class="ghost">텍스트/JSON 토글</button>
      <label class="row" style="margin-left:auto">음성코칭 <input type="checkbox" id="voiceToggle" checked></label>
    </div>
    <div id="routineCards" class="routine-cards"></div>
    <pre id="routineText"></pre>
  </section>

  <!-- 세션 -->
  <section class="card">
    <h2>운동 세션 (카메라)</h2>
    <div class="session-grid">
      <div class="video-wrap">
        <video id="video" playsinline></video>
        <canvas id="overlay"></canvas>
        <div id="feedback" class="feedback">종목을 선택해 시작하세요.</div>
      </div>
      <div class="controls">
        <div class="row">
          <label>운동<select id="exercise"><option value="squat">스쿼트</option><option value="deadlift">데드리프트</option><option value="bench">벤치프레스</option></select></label>
          <button id="previewBtn" class="ghost">카메라 미리보기</button>
        </div>
        <div class="row">
          <button id="startBtn">시작</button>
          <button id="stopBtn" disabled>중지</button>
          <button id="restBtn" class="ghost" disabled>세트 완료 · 휴식 시작</button>
        </div>
        <div class="stats">
          <div>정확도 <span id="accuracy">-</span>%</div>
          <div>반복 <span id="reps">0</span></div>
          <div>세트 <span id="sets">1</span></div>
        </div>
        <div class="timer hidden" id="restTimer">휴식 <span id="restSec">60</span>초</div>
        <button id="showAnalytics" class="ghost">기록 새로고침</button>
        <pre id="analyticsView"></pre>
      </div>
    </div>
  </section>
</main>

<footer><p>© ADIMO AI Coach – 브라우저에서만 영상 처리, 데이터는 로컬에 저장됩니다.</p></footer>
<script>const API_BASE="https://ai-coach-server-21ri.onrender.com";</script>
<script>
  const API_BASE = "https://ai-coach-v7-server.onrender.com";
</script>
<script defer src="app.js?v=7.4"></script>
</body>
</html>
